spring.application.name=mvt-events

# Database Configuration (with environment variable support)
spring.datasource.url=${SPRING_DATASOURCE_URL:jdbc:postgresql://localhost:5435/mvt-events}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME:mvt}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD:mvtpass}
spring.datasource.driver-class-name=org.postgresql.Driver

# JPA/Hibernate Configuration
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=${SPRING_JPA_SHOW_SQL:true}
spring.jpa.open-in-view=false
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.use_sql_comments=true

# Logging Configuration for debugging
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE
logging.level.org.hibernate.orm.jdbc.bind=TRACE
logging.level.com.mvt.mvt_events.tenant=DEBUG

# AOP Configuration for Tenant Filtering
spring.aop.auto=true
spring.aop.proxy-target-class=true

# Flyway Configuration
spring.flyway.enabled=true
spring.flyway.baseline-on-migrate=true
spring.flyway.baseline-version=0
spring.flyway.validate-on-migrate=true
spring.flyway.locations=classpath:db/migration

# JWT Configuration (Development defaults - override in production with environment variables)
jwt.secret=${JWT_SECRET:mvt-events-secret-key-for-jwt-authentication-very-long-secret-key-256-bits}
jwt.expiration=${JWT_EXPIRATION:18000}

# Security Configuration - Allow all access for development
spring.security.user.name=admin
spring.security.user.password=admin

# Actuator Security Configuration
management.endpoints.web.exposure.include=health,info,metrics
management.endpoint.health.show-details=when-authorized
management.endpoints.web.base-path=/actuator

# Server Configuration
server.address=0.0.0.0
server.port=${SERVER_PORT:8080}

# Tomcat Configuration - Fix for "Request header is too large"
server.tomcat.max-http-response-header-size=65536
server.max-http-request-header-size=65536

# Payment Configuration
# Default payment provider: STRIPE, MERCADOPAGO, or PAYPAL
payment.provider=${PAYMENT_PROVIDER:STRIPE}

# Stripe Configuration
payment.stripe.public-key=${STRIPE_PUBLIC_KEY:pk_test_PLACEHOLDER_REPLACE_WITH_REAL_KEY}
payment.stripe.secret-key=${STRIPE_SECRET_KEY:sk_test_PLACEHOLDER_REPLACE_WITH_REAL_KEY}
# Webhook secret do Stripe CLI
payment.stripe.webhook-secret=${STRIPE_WEBHOOK_SECRET:whsec_PLACEHOLDER_REPLACE_WITH_REAL_SECRET}

# MercadoPago Configuration
payment.mercadopago.public-key=${MERCADOPAGO_PUBLIC_KEY:}
payment.mercadopago.access-token=${MERCADOPAGO_ACCESS_TOKEN:}
payment.mercadopago.webhook-secret=${MERCADOPAGO_WEBHOOK_SECRET:}

# PayPal Configuration
payment.paypal.client-id=${PAYPAL_CLIENT_ID:}
payment.paypal.client-secret=${PAYPAL_CLIENT_SECRET:}
payment.paypal.environment=${PAYPAL_ENVIRONMENT:sandbox}

# Payment URLs (used for redirects and webhooks)
payment.return-url=${PAYMENT_RETURN_URL:http://localhost:3000/payment/success}
payment.cancel-url=${PAYMENT_CANCEL_URL:http://localhost:3000/payment/cancel}
payment.webhook-url=${PAYMENT_WEBHOOK_URL:http://localhost:8080/api/payments/webhook}

# Push Notifications Configuration (Expo)
# Token de produção configurado
expo.access-token=${EXPO_ACCESS_TOKEN:q_E_RBFanVt2NfWO2isuYFwEZ1u3d2sxdiagNFRZ}
expo.push-url=${EXPO_PUSH_URL:https://exp.host/--/api/v2/push/send}

# Web Push Notifications Configuration (VAPID)
# Chaves no formato base64url raw (correto para Web Push)
webpush.vapid.public-key=${VAPID_PUBLIC_KEY:BN8ym6-oByG6GoAEC9399ciwUoal_2vh1IyGph1xS9rnF0yC5GPHfrlgE-th3JqyPPaFOqXKnfQBYVj9oS5a15k}
webpush.vapid.private-key=${VAPID_PRIVATE_KEY:FADUse7iqBxTm1aqOjxgOAwZpg0pL3c-oElOw0Zxbjw}
webpush.vapid.subject=${VAPID_SUBJECT:mailto:admin@mvt-events.com}

# Push Notifications Logging
logging.level.com.mvt.mvt_events.service.PushNotificationService=DEBUG
logging.level.com.mvt.mvt_events.service.UserPushTokenService=DEBUG

# ============================================
# Iugu Payment Gateway Configuration
# ============================================
# Documentação: https://dev.iugu.com/reference/api-overview
# Painel: https://app.iugu.com
# Webhook: Configurar em "Administração" > "Webhook" para apontar para /api/webhooks/iugu

# Iugu API Configuration
# Mode: dry-run (mock/teste local), sandbox (Iugu teste), production (Iugu real)
iugu.mode=${IUGU_MODE:dry-run}
iugu.api.key=${IUGU_API_KEY:test_PLACEHOLDER_REPLACE_WITH_TEST_API_KEY}
iugu.api.url=${IUGU_API_URL:https://api.iugu.com/v1}
iugu.account.id=${IUGU_ACCOUNT_ID:PLACEHOLDER_MASTER_ACCOUNT_ID}

# Webhook Configuration
iugu.webhook.token=${IUGU_WEBHOOK_TOKEN:PLACEHOLDER_REPLACE_WITH_WEBHOOK_TOKEN}

# Split Payment Configuration (percentages)
# 87% para o motoboy, 5% para o gerente, 8% para a plataforma
iugu.split.motoboy-percentage=${IUGU_SPLIT_MOTOBOY:87.0}
iugu.split.manager-percentage=${IUGU_SPLIT_MANAGER:5.0}
iugu.split.platform-percentage=${IUGU_SPLIT_PLATFORM:8.0}

# Iugu Transaction Fee (fixed per transaction)
iugu.split.transaction-fee=${IUGU_TRANSACTION_FEE:0.59}

# Payment Threshold (minimum amount to trigger auto-withdraw in BRL)
iugu.payment.threshold=${IUGU_PAYMENT_THRESHOLD:100.00}

# Auto Withdraw Configuration (D+1 transfers)
iugu.auto-withdraw.enabled=${IUGU_AUTO_WITHDRAW_ENABLED:true}
iugu.auto-withdraw.delay-days=${IUGU_AUTO_WITHDRAW_DELAY_DAYS:1}

# Retry Configuration for API calls
iugu.retry.max-attempts=${IUGU_RETRY_MAX_ATTEMPTS:3}
iugu.retry.initial-backoff-ms=${IUGU_RETRY_INITIAL_BACKOFF:1000}

# Iugu Logging
logging.level.com.mvt.mvt_events.payment.service.IuguService=DEBUG

# ============================================
# Iugu Verification Sync Job Configuration
# ============================================
# Job agendado para sincronizar status de verificação de subcontas Iugu
# Processo: Consulta API Iugu a cada 6h para verificar se dados bancários foram validados

# Habilitar/desabilitar job de sincronização
iugu.verification-sync.enabled=${IUGU_VERIFICATION_SYNC_ENABLED:true}

# Cron expression: A cada 5 minutos (TESTE - em produção usar: 0 0 */6 * * *)
# Formato: segundo minuto hora dia mês dia-da-semana
iugu.verification-sync.cron=${IUGU_VERIFICATION_SYNC_CRON:0 */5 * * * *}

# Máximo de dias que uma conta pode ficar pendente antes de alertar
iugu.verification-sync.max-pending-days=${IUGU_MAX_PENDING_DAYS:10}

# Logging do job de sincronização
logging.level.com.mvt.mvt_events.payment.service.IuguVerificationSyncService=INFO

